/*eval((function(x){var d="";  var p=0;while(p<x.length){if(x.charAt(p)!="`")d+=x.charAt(p++);else{var l=x.charCodeAt(p+3)-28;if(l>4)d+=d.substr(d.length-x.charCodeAt(p+1)*96-x.charCodeAt(p+2)+3104-l,l);else d+="`";p+=4}}return d})("var stylesheet = $(document.createElement(\"link\"));` E&.attr({type:\"text/css\", href:\"css/transformable.` 8\"rel:\"` [&\"});$(\"head\").append(` 5&);(function ($) {$.fn.` k) = ` 9&options) {`\"6!ettings = {className:\"` R)Box\", minLength:10, deleteable:true` ,!Duration:\"fast\", bigKeyStep:5, small` ($1, enabledArrowKeys` b#rotate:false, keepPropor`!q!` /$defaultCursor:\"pointer\", multiSelect` D$clearHandler:null, s` <!OnC`$\\!`!2#un` 1\"` C$\"\", box` g\"` &+D`\"Z!` +&};return this.each`$*') {if`#m($.ext`$a!`#w#, ` 5$;}$(this).addClass` <%.`$7%);if ` .&`\" *) {` R-\"` =\"ed\"` L+`\"0, != \"\") {eval(String` 37+ \"`!%\"\"));}`!r%css({c`$6\"` T%`$F)});addTransBoxes` S\";updatePosition` .#`)'&).unbind(\"keydown\"` 0*` /#(keyPressed);`!L$mouse` 9!make`\"!\"ion` 7&drag(\"end\",`(C') {`!O\"` L\"ed`!U$s();`)T!` X\"parent(` |(` X)$(\"`$A#ed\").remove`$+.`#b1`&j+`#m%, `']!`#w\");var resizingNow =` 9\";});`!B%`#g*e`,T\"`*d#boxWidth`,!` 3$.width(` x\"boxHeigh`-A\"` :%h` /!` =#posArray = new ` '!(\"topLeft\", \"topCe`)g#\"topRigh` 4!middle` ?$` (\"` 4%bottom` 5$` (\"` ]&` *\"` G\"`'S+`+I\") {`!Q$.push(\"` 3!or\");}for (var i = 0; i <`!~%.l`-/!; i++`#!#currentBox`/q9div\")`!G\"` e$[i]`(|!`!3% {` c&`)c'miniBox\");}` ,0` d');` 6'`'=!drag`$~!former` /.`'0O`%!%`16#` i&);}}` a%`(l)(e`0z$wapped`&f%if (!e.shiftKey || !`$E%`/4'`-o#$`('$\".\" +`1g%`-B')`$=# > 0`)%!` />not`)q#`)23`+a${drag:\"drag`\"1%\"});`\"+&true`-0'`#{%`+W'`\"M!` 9$has` }-`.o@`\"lC`*sJ`\" #`+<\"`/>w`/C1`%o&`##)(ev,` -!Do`,2$posChange = {};` &%.top =` E$.deltaY` 4'left` 0,X;validateAndDraw(` G%`!C,`(\\'`!B/thi`$d\"`*a!`$W#ttr(\"`&E!`1V!`/g)each`0'*`\")/if ` g!` u!.indexOf(\"`,t# != -1`,g\"`\"=#`.{!`\"3.`$i!` V/`-d\"` U1`/A\"`#>.` S4`.h!`!78-`!E,`#z<` r4top`!T:` {+`%8(`%N1}`%(8`%;(`'*+`3#*thisDiv`2`)`2\\$` K! =` <$.` +$`2#thisOffset` 9'o` ,!();$.data` l$, \"` V$\", {top:` ($.top, left` )&left, `\"u\":` s$`4;$, `$8!` /%` )!(), `!6\"X` 4!`!S\"` b#` 3\"Y` -(top`\"r/`0K/ {`'b=`*d2` r(`.|\"` v$` b/fadeOut`,$&delDuration`29+`)`$` n\"`29\"`-',Delete`,oD` @*`-(+`!3%keyPressed(ev`*?6ev`/[%`35$tep =`1{&bigKeyStep;} else` 12small` @%var keyU`#f!`3%switch`!0!keyCode) {case 46:`\"h)d`\"?!able) {`#,;}break;` U!37:`*3-- Math.abs(step);`!?(`39!` U(8` V'`)u\"` 2J9`!/.` 4G40`!.-` 8Bdefault:`37+enabledArrowKeys &&`$ &`$~!`+n5`(\\5;ev.preventD`!0\"(`&?)` d,moveObj`))@`,2$Po`20!`, \"this`+w(`,z%`'4&`+|!` R#`+0#top` )%top}`--%Parent`3)'p` ,!`-Q#blocks =`-!\"`'$!`,y#` %#`,q#` '#`,g\"` (!`34#ypeof `\"M#`$^!!= \"undefined\") {if `\"m$` <!< 0`0i)`%-'max(0,`\"l$` 5!+` q(`+8\"` L+=` k!`\"$\"` f#` H5;}`)$`!k/`28#`!p-`!U2i`-x\"`#Z\"`/h% - (`#b$` +%`!9&` -\")`\"&9`!Z$` hK`!&,` f:}`(T!`\"R+`)|!`$C9` =!`$Q,`*L(`$S+` 6!`!2&left`$T,` X\"`$X)` j#` J7`$K9`'!!`$K8`!d)`#C*`4:#`$[(` +$`!8&` -!`#V'`\"11`$U.` rA`!'+` e<`$S1`\"J3if (!`#X'`$m+` P\"`$m,` 0\"`$s'`.D%minLength`!Z&` G\"`\"y,`%\"+` k#`34'` a%`!K#`&RA`\"\"#`!X$`\"x+`!D*-` y/`$8%` N7;}`&?%`\"Z4`$P4`%)*`\"b=` m7`$2*`\"+,+`/=#`!h$`,MG`%D(top`%@+` O#`%@,` 0#`%*C` G#`-0-`%D+` m$`%*F`0u1`\"%#`!Z%`-3*`!E+`%0@` V0`%?1`\"g+`.l5`/G)`\"d?` o8`$:+`\"0-`%Q%`!o\"if (`\"*)`2'/` 3);` G(`'!\"`,[/` 4(;}`,V$css`$u&);});}};})(jQuery);"))*/

var stylesheet = jQuery(document.createElement("link"));
stylesheet.attr({
	type: "text/css",
	href: "css/transformable.css",
	rel: "stylesheet"
});
jQuery("head").append(stylesheet);
(function ($) {
	$.fn.transformable = function (options) {
		var settings = {
			className: "transformableBox",
			minLength: 10,
			deleteable: true,
			delDuration: "fast",
			bigKeyStep: 5,
			smallKeyStep: 1,
			enabledArrowKeys: true,
			rotate: false,
			keepProportions: false,
			defaultCursor: "pointer",
			multiSelect: false,
			clearHandler: null,
			selectOnCreate: true,
			unselectHandler: "",
			boxSelectHandler: "",
			boxDeleteHandler: ""
		};
		return this.each(function () {
			if (options) {
				$.extend(settings, options);
			}
			$(this).addClass(settings.className);
			if (settings.selectOnCreate) {
				$(this).addClass("selected");
				if (settings.boxSelectHandler != "") {
					eval(String(settings.boxSelectHandler + "(this)"));
				}
			}
			$(this).css({
				cursor: settings.defaultCursor
			});
			addTransBoxes(this);
			updatePosition(this);
			$(document).unbind("keydown");
			$(document).keydown(keyPressed);
			$(this).mousedown(makeSelection);
			$(this).drag("end", function () {
				updateSelectedPositions();
			});
			$(this).parent().mousedown(function () {
				$(".selected").removeClass("selected");
				eval(String(settings.unselectHandler + "(this, false)"));
			});
			var resizingNow = false;
		});
		function addTransBoxes(element) {
			var boxWidth = $(element).width();
			var boxHeight = $(element).height();
			var posArray = new Array("topLeft", "topCenter", "topRight", "middleLeft", "middleRight", "bottomLeft", "bottomCenter", "bottomRight");
			if (settings.rotate) {
				posArray.push("rotator");
			}
			for (var i = 0; i < posArray.length; i++) {
				var currentBox = $(document.createElement("div"));
				if (posArray[i] != "rotator") {
					currentBox.addClass("miniBox");
				}
				currentBox.addClass(posArray[i]);
				currentBox.drag(dragTransformer);
				currentBox.drag("end", function () {
					updateSelectedPositions();
				});
				$(element).append(currentBox);
			}
		}
		function makeSelection(e) {
			var swapped = false;
			if (!e.shiftKey || !settings.multiSelect) {
				if ($(String("." + settings.className)).length > 0) {
					$(String("." + settings.className)).not(this).removeClass("selected").unbind({
						drag: "dragSelection"
					});
					swapped = true;
				}
			}
			$(this).drag(dragSelection);
			if (!$(this).hasClass("selected")) {
				$(this).addClass("selected");
				if (!e.shiftKey || !settings.multiSelect) {
					eval(String(settings.unselectHandler + "(this,swapped)"));
				}
				if (settings.boxSelectHandler != "") {
					eval(String(settings.boxSelectHandler + "(this)"));
				}
			}
			updatePosition(this);
		}
		function dragSelection(ev, dragDot) {
			var posChange = {};
			posChange.top = dragDot.deltaY;
			posChange.left = dragDot.deltaX;
			validateAndDraw(posChange);
		}
		function dragTransformer(ev, dragDot) {
			var thisClass = $(this).attr("class");
			$(".selected").each(function () {
				var posChange = {};
				if (thisClass.indexOf("Right") != -1) {
					posChange.width = dragDot.deltaX;
				}
				if (thisClass.indexOf("bottom") != -1) {
					posChange.height = dragDot.deltaY;
				}
				if (thisClass.indexOf("Left") != -1) {
					posChange.width = -dragDot.deltaX;
					posChange.left = dragDot.deltaX;
				}
				if (thisClass.indexOf("top") != -1) {
					posChange.height = -dragDot.deltaY;
					posChange.top = dragDot.deltaY;
				}
				validateAndDraw(posChange);
			});
		}
		function updatePosition(element) {
			var thisDiv = $(element);
			var position = thisDiv.position();
			var thisOffset = thisDiv.offset();
			$.data(element, "position", {
				top: position.top,
				left: position.left,
				height: thisDiv.height(),
				width: thisDiv.width(),
				offsetX: thisOffset.left,
				offsetY: thisOffset.top
			});
		}
		function updateSelectedPositions() {
			$(".selected").each(function () {
				updatePosition(this);
			});
		}
		function removeSelected() {
			$(".selected").fadeOut(settings.delDuration, function () {
				$(this).remove();
			});
			if (settings.boxDeleteHandler != "") {
				eval(String(settings.boxDeleteHandler + "(this)"));
			}
		}
		function keyPressed(ev) {
			var posChange = {};
			if (ev.shiftKey) {
				var step = settings.bigKeyStep;
			} else {
				var step = settings.smallKeyStep;
			}
			var keyUpdate = false;
			switch (ev.keyCode) {
			case 46:
				if (settings.deleteable) {
					removeSelected();
				}
				break;
			case 37:
				posChange.left = -Math.abs(step);
				keyUpdate = true;
				break;
			case 38:
				posChange.top = -Math.abs(step);
				keyUpdate = true;
				break;
			case 39:
				posChange.left = Math.abs(step);
				keyUpdate = true;
				break;
			case 40:
				posChange.top = Math.abs(step);
				keyUpdate = true;
				break;
			default:
				;
			}
			if (settings.enabledArrowKeys && keyUpdate) {
				validateAndDraw(posChange);
				updateSelectedPositions();
				ev.preventDefault();
			}
		}
		function validateAndDraw(moveObj) {
			$(".selected").each(function () {
				var thisPos = $.data(this, "position");
				var posChange = {
					left: thisPos.left,
					top: thisPos.top
				};
				var thisParent = $(this).parent();
				var blocks = {
					top: false,
					left: false,
					height: false,
					width: false
				};
				if (typeof moveObj.top != "undefined") {
					if (moveObj.top < 0) {
						posChange.top = Math.max(0, thisPos.top + moveObj.top);
						if (posChange.top == 0) {
							blocks.top = thisPos.top + moveObj.top;
						}
					} else {
						if (typeof moveObj.height != "undefined") {
							posChange.top = Math.min(thisParent.height() - ($(this).height() + moveObj.height), thisPos.top + moveObj.top);
						} else {
							posChange.top = Math.min(thisParent.height() - $(this).height(), thisPos.top + moveObj.top);
						}
					}
				}
				if (typeof moveObj.left != "undefined") {
					if (moveObj.left < 0) {
						posChange.left = Math.max(0, thisPos.left + moveObj.left);
						if (posChange.left == 0) {
							blocks.left = thisPos.left + moveObj.left;
						}
					} else {
						if (typeof moveObj.width != "undefined") {
							posChange.left = Math.min(thisParent.width() - ($(this).width() + moveObj.width), thisPos.left + moveObj.left);
						} else {
							posChange.left = Math.min(thisParent.width() - $(this).width(), thisPos.left + moveObj.left);
						}
					}
				}
				if (typeof moveObj.width != "undefined") {
					if (!blocks.left) {
						if (moveObj.width < 0) {
							posChange.width = Math.max(settings.minLength, thisPos.width + moveObj.width);
							if (posChange.width == settings.minLength) {
								if (typeof moveObj.left != "undefined") {
									blocks.width = thisPos.left + thisPos.width - settings.minLength;
								} else {
									blocks.width = thisPos.left;
								}
							}
						} else {
							posChange.width = Math.min(thisParent.width() - posChange.left, thisPos.width + moveObj.width);
						}
					} else {
						posChange.width = moveObj.width + thisPos.width + blocks.left;
					}
				}
				if (typeof moveObj.height != "undefined") {
					if (!blocks.top) {
						if (moveObj.height < 0) {
							posChange.height = Math.max(settings.minLength, thisPos.height + moveObj.height);
							if (posChange.height == settings.minLength) {
								if (typeof moveObj.top != "undefined") {
									blocks.height = thisPos.top + thisPos.height - settings.minLength;
								} else {
									blocks.height = thisPos.top;
								}
							}
						} else {
							posChange.height = Math.min(thisParent.height() - posChange.top, thisPos.height + moveObj.height);
						}
					} else {
						posChange.height = moveObj.height + thisPos.height + blocks.top;
					}
				}
				if (blocks.height) {
					posChange.top = blocks.height;
				}
				if (blocks.width) {
					posChange.left = blocks.width;
				}
				$(this).css(posChange);
			});
		}
	};
})(jQuery);